<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Verb Form Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f9ff;
        color: #1e293b;
        overflow-x: hidden;
      }
      .game-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }
      .card {
        background-color: #ffffff;
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        text-align: center;
        width: 100%;
        max-width: 900px;
        border: 1px solid #e0f2fe;
        position: relative;
      }
      .close-btn {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background-color: #f1f5f9;
        color: #64748b;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
      }
      .close-btn:hover {
        background-color: #e2e8f0;
        transform: scale(1.1);
      }
      #top-bar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-bottom: 1.5rem;
        width: 100%;
      }
      #score-container {
        display: flex;
        gap: 1rem;
      }
      .score-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      #correct-score {
        background-color: #22c55e;
      }
      #incorrect-score {
        background-color: #ef4444;
      }
      #sentences-container {
        list-style-type: decimal;
        list-style-position: inside;
        text-align: left;
        font-size: 1.1rem;
        line-height: 2.5;
      }
      .sentence-item {
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        margin-bottom: 0.1rem;
      }
      .blank-select {
        display: inline-block;
        width: 120px;
        height: 40px;
        background-color: #e2e8f0;
        border: 2px solid #cbd5e1;
        border-radius: 0.5rem;
        margin: 0 4px -10px 4px;
        transition: all 0.3s ease;
        text-align: center;
        vertical-align: middle;
        font-size: 1.1rem;
        font-weight: 600;
        padding: 0 0.5rem;
      }
      .blank-select:focus {
        outline: none;
        border-color: #3b82f6;
        background-color: #e0f2fe;
      }
      .blank-select.correct {
        background-color: #4ade80;
        border-color: #22c55e;
        color: white;
      }
      .blank-select.incorrect {
        background-color: #f87171;
        border-color: #ef4444;
        color: white;
      }
      .feedback-mark {
        display: inline-block;
        margin-left: 0.75rem;
        font-size: 1.5rem;
        font-weight: bold;
        visibility: hidden;
      }
      .feedback-mark.correct {
        color: #22c55e;
        visibility: visible;
      }
      .feedback-mark.incorrect {
        color: #ef4444;
        visibility: visible;
      }
      .btn {
        padding: 0.75rem 2rem;
        border-radius: 0.75rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: #3b82f6;
        color: white;
      }
      .btn-primary:hover {
        background-color: #2563eb;
        transform: translateY(-2px);
      }
      .btn-secondary {
        background-color: #e2e8f0;
        color: #334155;
      }
      .btn-secondary:hover {
        background-color: #cbd5e1;
        transform: translateY(-2px);
      }
      #reward-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="card">
        <button id="close-btn" class="close-btn" aria-label="Close">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h1
          class="text-4xl font-bold text-slate-800 mb-2"
          style="font-family: 'Pacifico', cursive"
        >
          Verb Form Practice
        </h1>
        <p class="mb-6 text-lg text-slate-500">
          Fill in the blanks with the correct verb.
        </p>

        <div id="top-bar">
          <div id="score-container">
            <div id="correct-score" class="score-circle">0</div>
            <div id="incorrect-score" class="score-circle">0</div>
          </div>
        </div>

        <ol id="sentences-container"></ol>

        <div class="mt-8 flex justify-center space-x-4">
          <button id="reset-btn" class="btn btn-secondary">Try Again</button>
          <button id="check-btn" class="btn btn-primary">Check Answers</button>
        </div>
      </div>
    </div>

    <canvas id="reward-canvas"></canvas>

    <script>
      // --- Game Data ---
      const sentencesData = [
        {
          text: "The teacher ______ the lesson.",
          options: ["explains", "explaining"],
          correctAnswer: "explains",
        },
        {
          text: "The lesson is ______ by the teacher.",
          options: ["explain", "explained"],
          correctAnswer: "explained",
        },
        {
          text: "She ______ a letter.",
          options: ["writes", "written"],
          correctAnswer: "writes",
        },
        {
          text: "A letter is ______ by her.",
          options: ["wrote", "written"],
          correctAnswer: "written",
        },
        {
          text: "They ______ the classroom every morning.",
          options: ["clean", "cleaned"],
          correctAnswer: "clean",
        },
        {
          text: "The classroom is ______ every morning by them.",
          options: ["cleaned", "clean"],
          correctAnswer: "cleaned",
        },
        {
          text: "He ______ the old man.",
          options: ["helps", "help"],
          correctAnswer: "helps",
        },
        {
          text: "The old man is ______ by him.",
          options: ["helped", "helping"],
          correctAnswer: "helped",
        },
        {
          text: "The students ______ the project yesterday.",
          options: ["complete", "completed"],
          correctAnswer: "completed",
        },
        {
          text: "The project was ______ by the students yesterday.",
          options: ["completed", "complete"],
          correctAnswer: "completed",
        },
        {
          text: "She ______ the picture last week.",
          options: ["painted", "paints"],
          correctAnswer: "painted",
        },
        {
          text: "The picture was ______ by her last week.",
          options: ["paint", "painted"],
          correctAnswer: "painted",
        },
        {
          text: "They ______ a bridge in 2010.",
          options: ["built", "build"],
          correctAnswer: "built",
        },
        {
          text: "A bridge was ______ by them in 2010.",
          options: ["built", "building"],
          correctAnswer: "built",
        },
        {
          text: "He ______ the door.",
          options: ["opened", "open"],
          correctAnswer: "opened",
        },
        {
          text: "The door was ______ by him.",
          options: ["opened", "open"],
          correctAnswer: "opened",
        },
        {
          text: "I will ______ the work tomorrow.",
          options: ["finish", "finished"],
          correctAnswer: "finish",
        },
        {
          text: "The work will be ______ by me tomorrow.",
          options: ["finished", "finish"],
          correctAnswer: "finished",
        },
        {
          text: "She will ______ the message.",
          options: ["deliver", "delivered"],
          correctAnswer: "deliver",
        },
        {
          text: "The message will be ______ by her.",
          options: ["delivered", "deliver"],
          correctAnswer: "delivered",
        },
        {
          text: "They will ______ the road next month.",
          options: ["repair", "repaired"],
          correctAnswer: "repair",
        },
        {
          text: "The road will be ______ by them next month.",
          options: ["repaired", "repair"],
          correctAnswer: "repaired",
        },
        {
          text: "He is ______ a story.",
          options: ["reading", "read"],
          correctAnswer: "reading",
        },
        {
          text: "A story is being ______ by him.",
          options: ["read", "reading"],
          correctAnswer: "read",
        },
        {
          text: "She is ______ a cake.",
          options: ["baking", "baked"],
          correctAnswer: "baking",
        },
        {
          text: "A cake is being ______ by her.",
          options: ["baked", "baking"],
          correctAnswer: "baked",
        },
        {
          text: "They are ______ the car.",
          options: ["repairing", "repaired"],
          correctAnswer: "repairing",
        },
        {
          text: "The car is being ______ by them.",
          options: ["repaired", "repairing"],
          correctAnswer: "repaired",
        },
        {
          text: "We are ______ trees in the park.",
          options: ["planting", "planted"],
          correctAnswer: "planting",
        },
        {
          text: "Trees are being ______ in the park by us.",
          options: ["planted", "planting"],
          correctAnswer: "planted",
        },
        {
          text: "I have ______ the homework.",
          options: ["completed", "complete"],
          correctAnswer: "completed",
        },
        {
          text: "The homework has been ______ by me.",
          options: ["completed", "complete"],
          correctAnswer: "completed",
        },
        {
          text: "She has ______ three poems.",
          options: ["written", "write"],
          correctAnswer: "written",
        },
        {
          text: "Three poems have been ______ by her.",
          options: ["written", "writing"],
          correctAnswer: "written",
        },
        {
          text: "They had ______ the house before lunch.",
          options: ["cleaned", "cleaning"],
          correctAnswer: "cleaned",
        },
        {
          text: "The house had been ______ by them before lunch.",
          options: ["cleaned", "clean"],
          correctAnswer: "cleaned",
        },
        {
          text: "He had ______ the bike before the trip.",
          options: ["repaired", "repairing"],
          correctAnswer: "repaired",
        },
        {
          text: "The bike had been ______ by him before the trip.",
          options: ["repaired", "repair"],
          correctAnswer: "repaired",
        },
        {
          text: "The chef had ______ the food before the guests arrived.",
          options: ["prepared", "preparing"],
          correctAnswer: "prepared",
        },
        {
          text: "The food had been ______ by the chef before the guests arrived.",
          options: ["prepared", "prepare"],
          correctAnswer: "prepared",
        },
      ];

      // --- DOM Elements ---
      const sentencesContainer = document.getElementById("sentences-container");
      const closeBtn = document.getElementById("close-btn");
      const checkBtn = document.getElementById("check-btn");
      const resetBtn = document.getElementById("reset-btn");
      const correctScoreEl = document.getElementById("correct-score");
      const incorrectScoreEl = document.getElementById("incorrect-score");
      const canvas = document.getElementById("reward-canvas");
      const ctx = canvas.getContext("2d");

      // --- Game State ---
      let correctCount = 0;
      let incorrectCount = 0;

      // --- Initialization ---
      function initializeGame() {
        sentencesContainer.innerHTML = "";
        correctCount = 0;
        incorrectCount = 0;
        updateScores();
        checkBtn.disabled = false;

        sentencesData.forEach((item) => {
          const li = document.createElement("li");
          li.className = "sentence-item";

          const sentenceParts = item.text.split("______");

          li.textContent = sentenceParts[0];

          const select = document.createElement("select");
          select.className = "blank-select";
          select.dataset.correctAnswer = item.correctAnswer;

          const defaultOption = document.createElement("option");
          defaultOption.value = "";
          defaultOption.textContent = "---";
          select.appendChild(defaultOption);

          const shuffledOptions = item.options.sort(() => 0.5 - Math.random());
          shuffledOptions.forEach((optionText) => {
            const option = document.createElement("option");
            option.value = optionText;
            option.textContent = optionText;
            select.appendChild(option);
          });

          li.appendChild(select);
          li.innerHTML += sentenceParts[1];
          li.innerHTML += ` <span class="feedback-mark"></span>`;

          sentencesContainer.appendChild(li);
        });
      }

      // --- Answer Checking ---
      function checkAnswers() {
        const selects = document.querySelectorAll(".blank-select");
        correctCount = 0;
        incorrectCount = 0;

        selects.forEach((select) => {
          const userAnswer = select.value.trim().toLowerCase();
          const correctAnswer = select.dataset.correctAnswer.toLowerCase();
          const feedbackMark =
            select.parentElement.querySelector(".feedback-mark");

          select.classList.remove("correct", "incorrect");
          feedbackMark.classList.remove("correct", "incorrect");

          if (userAnswer) {
            if (userAnswer === correctAnswer) {
              feedbackMark.textContent = "✓";
              feedbackMark.classList.add("correct");
              select.classList.add("correct");
              correctCount++;
            } else {
              feedbackMark.textContent = "✗";
              feedbackMark.classList.add("incorrect");
              select.classList.add("incorrect");
              incorrectCount++;
            }
          }
        });

        updateScores();
        checkBtn.disabled = true;

        if (correctCount + incorrectCount === sentencesData.length) {
          triggerReward(correctCount);
        }
      }

      function updateScores() {
        correctScoreEl.textContent = correctCount;
        incorrectScoreEl.textContent = incorrectCount;
      }

      // --- Reward System (unchanged) ---
      function triggerReward(score) {
        if (score >= 1 && score <= 10) {
          launchStars(1);
        } else if (score >= 11 && score <= 20) {
          launchStars(2);
        } else if (score >= 21 && score <= 30) {
          launchStars(3);
        } else if (score >= 31 && score < 40) {
          launchStars(4);
        } else if (score === 40) {
          starRain();
        }
      }

      // --- Canvas Animation (unchanged) ---
      let stars = [];
      let animationFrameId;

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      class Star {
        constructor(x, y, radius, color, velocity) {
          this.x = x;
          this.y = y;
          this.radius = radius;
          this.color = color;
          this.velocity = velocity;
          this.alpha = 1;
          this.gravity = 0.05;
          this.friction = 0.99;
        }
        draw() {
          ctx.save();
          ctx.globalAlpha = this.alpha;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fillStyle = this.color;
          ctx.fill();
          ctx.restore();
        }
        update() {
          this.velocity.y += this.gravity;
          this.velocity.x *= this.friction;
          this.x += this.velocity.x;
          this.y += this.velocity.y;
          this.alpha -= 0.01;
          this.draw();
        }
      }

      function animateStars() {
        animationFrameId = requestAnimationFrame(animateStars);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        stars.forEach((star, index) => {
          if (star.alpha > 0) star.update();
          else stars.splice(index, 1);
        });
        if (stars.length === 0) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
      }

      function launchStars(count) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const colors = ["#fde047", "#f97316", "#84cc16", "#38bdf8"];
        for (let i = 0; i < count; i++) {
          const radius = 25 + Math.random() * 15;
          const x = centerX - 200 + i * 200;
          const y = centerY;
          const color = colors[i % colors.length];
          const velocity = {
            x: (Math.random() - 0.5) * 4,
            y: -12 - Math.random() * 5,
          };
          stars.push(new Star(x, y, radius, color, velocity));
        }
        if (!animationFrameId) animateStars();
      }

      function starRain() {
        for (let i = 0; i < 150; i++) {
          const radius = Math.random() * 3 + 1;
          const x = Math.random() * canvas.width;
          const y = -Math.random() * canvas.height;
          const color = `hsl(${Math.random() * 360}, 100%, 75%)`;
          const velocity = {
            x: (Math.random() - 0.5) * 2,
            y: 4 + Math.random() * 5,
          };
          stars.push(new Star(x, y, radius, color, velocity));
        }
        if (!animationFrameId) animateStars();
      }

      // --- Event Listeners ---
      closeBtn.addEventListener("click", () => window.close());
      checkBtn.addEventListener("click", checkAnswers);
      resetBtn.addEventListener("click", initializeGame);
      window.addEventListener("resize", resizeCanvas);

      // --- Initial Load ---
      window.onload = () => {
        resizeCanvas();
        initializeGame();
      };
    </script>
  </body>
</html>
