<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mixed Tense Verb Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f9ff;
        color: #1e293b;
        overflow-x: hidden;
      }
      .game-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }
      .card {
        background-color: #ffffff;
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        text-align: center;
        width: 100%;
        max-width: 900px;
        border: 1px solid #e0f2fe;
        position: relative;
      }
      .close-btn {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background-color: #f1f5f9;
        color: #64748b;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
      }
      .close-btn:hover {
        background-color: #e2e8f0;
        transform: scale(1.1);
      }
      #top-bar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-bottom: 1.5rem;
        width: 100%;
      }
      #score-container {
        display: flex;
        gap: 1rem;
      }
      .score-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      #correct-score {
        background-color: #22c55e;
      }
      #incorrect-score {
        background-color: #ef4444;
      }

      #sentences-container {
        list-style-type: decimal;
        list-style-position: inside;
        text-align: left;
        font-size: 1.2rem;
        line-height: 3;
      }
      .sentence-item {
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        margin-bottom: 0.1rem;
      }
      .blank-select {
        display: inline-block;
        width: 170px; /* Adjusted width for negative verb forms */
        height: 40px;
        background-color: #e2e8f0;
        border: 2px solid #cbd5e1;
        border-radius: 0.5rem;
        margin: 0 4px -10px 4px;
        transition: all 0.3s ease;
        vertical-align: middle;
        font-size: 1.1rem;
        font-weight: 600;
        padding-left: 10px; /* Add some padding */
      }
      .blank-select:focus {
        outline: none;
        border-color: #3b82f6;
        background-color: #e0f2fe;
      }
      .blank-select.correct {
        background-color: #4ade80;
        border-color: #22c55e;
        color: white;
      }
      .blank-select.incorrect {
        background-color: #f87171;
        border-color: #ef4444;
        color: white;
      }
      .feedback-mark {
        display: inline-block;
        margin-left: 0.75rem;
        font-size: 1.5rem;
        font-weight: bold;
        visibility: hidden;
      }
      .feedback-mark.correct {
        color: #22c55e;
        visibility: visible;
      }
      .feedback-mark.incorrect {
        color: #ef4444;
        visibility: visible;
      }
      .btn {
        padding: 0.75rem 2rem;
        border-radius: 0.75rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: #3b82f6;
        color: white;
      }
      .btn-primary:hover {
        background-color: #2563eb;
        transform: translateY(-2px);
      }
      .btn-secondary {
        background-color: #e2e8f0;
        color: #334155;
      }
      .btn-secondary:hover {
        background-color: #cbd5e1;
        transform: translateY(-2px);
      }
      #reward-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="card">
        <button id="close-btn" class="close-btn" aria-label="Close">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h1
          class="text-4xl font-bold text-slate-800 mb-2"
          style="font-family: 'Pacifico', cursive"
        >
          Mixed Tense Verb Practice: Negative Present Perfect & Past Perfect
        </h1>
        <p class="mb-6 text-lg text-slate-500">
          Choose the correct negative verb form (Present Perfect or Past
          Perfect) to complete each sentence.
        </p>

        <div id="top-bar">
          <div id="score-container">
            <div id="correct-score" class="score-circle">0</div>
            <div id="incorrect-score" class="score-circle">0</div>
          </div>
        </div>

        <ol id="sentences-container"></ol>

        <div class="mt-8 flex justify-center space-x-4">
          <button id="reset-btn" class="btn btn-secondary">Try Again</button>
          <button id="check-btn" class="btn btn-primary">Check Answers</button>
        </div>
      </div>
    </div>

    <canvas id="reward-canvas"></canvas>

    <script>
      // --- Game Data ---
      const sentencesData = [
        {
          start: "I",
          correctVerb: "have not finished",
          options: ["have not finished", "had not finished"],
          end: "my homework yet.",
        },
        {
          start: "She",
          correctVerb: "had not eaten",
          options: ["had not eaten", "has not eaten"],
          end: "lunch before the meeting started.",
        },
        {
          start: "We",
          correctVerb: "have not visited",
          options: ["have not visited", "had not visited"],
          end: "Galle this year.",
        },
        {
          start: "They",
          correctVerb: "had not left",
          options: ["had not left", "have not left"],
          end: "the party before I arrived.",
        },
        {
          start: "He",
          correctVerb: "has not seen",
          options: ["has not seen", "had not seen"],
          end: "that movie before.",
        },
        {
          start: "I",
          correctVerb: "had not called",
          options: ["had not called", "have not called"],
          end: "you before you sent me the message.",
        },
        {
          start: "She",
          correctVerb: "has not won",
          options: ["has not won", "had not won"],
          end: "any prizes in dancing competitions.",
        },
        {
          start: "We",
          correctVerb: "had not cleaned",
          options: ["had not cleaned", "have not cleaned"],
          end: "the classroom before the teacher came in.",
        },
        {
          start: "My parents",
          correctVerb: "have not traveled",
          options: ["have not traveled", "had not traveled"],
          end: "to India before.",
        },
        {
          start: "He",
          correctVerb: "had not broken",
          options: ["had not broken", "has not broken"],
          end: "his leg before the football season began.",
        },
        {
          start: "I",
          correctVerb: "have not read",
          options: ["have not read", "had not read"],
          end: "any books this month.",
        },
        {
          start: "She",
          correctVerb: "had not finished",
          options: ["had not finished", "has not finished"],
          end: "the project before the deadline.",
        },
        {
          start: "They",
          correctVerb: "have not learned",
          options: ["have not learned", "had not learned"],
          end: "new songs for the concert.",
        },
        {
          start: "I",
          correctVerb: "had not forgotten",
          options: ["had not forgotten", "have not forgotten"],
          end: "to lock the door before I left.",
        },
        {
          start: "We",
          correctVerb: "have not eaten",
          options: ["have not eaten", "had not eaten"],
          end: "breakfast yet.",
        },
        {
          start: "He",
          correctVerb: "had not written",
          options: ["had not written", "has not written"],
          end: "three letters before noon.",
        },
        {
          start: "She",
          correctVerb: "had not visited",
          options: ["had not visited", "has not visited"],
          end: "London before she moved to Paris.",
        },
        {
          start: "I",
          correctVerb: "have not seen",
          options: ["have not seen", "had not seen"],
          end: "such a beautiful sunset before.",
        },
        {
          start: "They",
          correctVerb: "had not finished",
          options: ["had not finished", "have not finished"],
          end: "their homework before going to the park.",
        },
        {
          start: "We",
          correctVerb: "have not watched",
          options: ["have not watched", "had not watched"],
          end: "that film yet.",
        },
        {
          start: "He",
          correctVerb: "had not lost",
          options: ["had not lost", "has not lost"],
          end: "his keys before he entered the house.",
        },
        {
          start: "I",
          correctVerb: "have not practiced",
          options: ["have not practiced", "had not practiced"],
          end: "the piano for two hours today.",
        },
        {
          start: "She",
          correctVerb: "had not started",
          options: ["had not started", "has not started"],
          end: "cooking before her guests arrived.",
        },
        {
          start: "They",
          correctVerb: "have not painted",
          options: ["have not painted", "had not painted"],
          end: "the fence recently.",
        },
        {
          start: "We",
          correctVerb: "had not met",
          options: ["had not met", "have not met"],
          end: "before the party started.",
        },
        {
          start: "I",
          correctVerb: "have not traveled",
          options: ["have not traveled", "had not traveled"],
          end: "to Anuradhapura before.",
        },
        {
          start: "He",
          correctVerb: "had not left",
          options: ["had not left", "has not left"],
          end: "by the time I reached the station.",
        },
        {
          start: "She",
          correctVerb: "has not studied",
          options: ["has not studied", "had not studied"],
          end: "English for five years.",
        },
        {
          start: "They",
          correctVerb: "had not sold",
          options: ["had not sold", "have not sold"],
          end: "their car before they moved to the city.",
        },
        {
          start: "We",
          correctVerb: "have not visited",
          options: ["have not visited", "had not visited"],
          end: "the new library yet.",
        },
        {
          start: "I",
          correctVerb: "had not finished",
          options: ["had not finished", "have not finished"],
          end: "the report before the meeting began.",
        },
        {
          start: "He",
          correctVerb: "has not seen",
          options: ["has not seen", "had not seen"],
          end: "the play before.",
        },
        {
          start: "She",
          correctVerb: "had not washed",
          options: ["had not washed", "has not washed"],
          end: "the dishes before her mother came home.",
        },
        {
          start: "They",
          correctVerb: "have not played",
          options: ["have not played", "had not played"],
          end: "in the garden many times.",
        },
        {
          start: "I",
          correctVerb: "had not cleaned",
          options: ["had not cleaned", "have not cleaned"],
          end: "my room before you came in.",
        },
        {
          start: "He",
          correctVerb: "has not been",
          options: ["has not been", "had not been"],
          end: "to Australia before.",
        },
        {
          start: "She",
          correctVerb: "had not left",
          options: ["had not left", "has not left"],
          end: "the office before the rain started.",
        },
        {
          start: "We",
          correctVerb: "have not eaten",
          options: ["have not eaten", "had not eaten"],
          end: "at that restaurant before.",
        },
        {
          start: "They",
          correctVerb: "had not arrived",
          options: ["had not arrived", "have not arrived"],
          end: "before the ceremony began.",
        },
        {
          start: "I",
          correctVerb: "have not visited",
          options: ["have not visited", "had not visited"],
          end: "Sigiriya before.",
        },
      ];

      // --- DOM Elements ---
      const sentencesContainer = document.getElementById("sentences-container");
      const closeBtn = document.getElementById("close-btn");
      const checkBtn = document.getElementById("check-btn");
      const resetBtn = document.getElementById("reset-btn");
      const correctScoreEl = document.getElementById("correct-score");
      const incorrectScoreEl = document.getElementById("incorrect-score");
      const canvas = document.getElementById("reward-canvas");
      const ctx = canvas.getContext("2d");

      // --- Game State ---
      let correctCount = 0;
      let incorrectCount = 0;

      // --- Shuffle Array Function ---
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]]; // Swap elements
        }
      }

      // --- Initialization ---
      function initializeGame() {
        sentencesContainer.innerHTML = "";
        correctCount = 0;
        incorrectCount = 0;
        updateScores();
        checkBtn.disabled = false;

        // Shuffle the sentences data
        shuffleArray(sentencesData);

        sentencesData.forEach((item) => {
          const li = document.createElement("li");
          li.className = "sentence-item flex items-center";

          // Add the start of the sentence
          li.innerHTML = `${item.start} `;

          // Create and append the select dropdown
          const select = document.createElement("select");
          select.className = "blank-select";
          select.dataset.correctVerb = item.correctVerb;

          // Default blank option
          const defaultOption = document.createElement("option");
          defaultOption.value = "";
          defaultOption.textContent = "---";
          select.appendChild(defaultOption);

          // Add the verb options
          const shuffledOptions = [...item.options].sort(
            () => 0.5 - Math.random()
          ); // Shuffle a copy
          shuffledOptions.forEach((optionText) => {
            const option = document.createElement("option");
            option.textContent = optionText;
            option.value = optionText;
            select.appendChild(option);
          });

          li.appendChild(select);
          // Add the remainder of the sentence and feedback mark
          li.innerHTML += ` ${item.end} <span class="feedback-mark"></span>`;

          sentencesContainer.appendChild(li);
        });
      }

      // --- Answer Checking ---
      function checkAnswers() {
        const selects = document.querySelectorAll(".blank-select");
        correctCount = 0;
        incorrectCount = 0;

        selects.forEach((select) => {
          const userAnswer = select.value.trim();
          const correctVerb = select.dataset.correctVerb;
          const feedbackMark =
            select.parentElement.querySelector(".feedback-mark");

          select.classList.remove("correct", "incorrect");
          feedbackMark.classList.remove("correct", "incorrect");
          feedbackMark.style.visibility = "hidden";

          if (userAnswer) {
            if (userAnswer === correctVerb) {
              feedbackMark.textContent = "✓";
              feedbackMark.classList.add("correct");
              select.classList.add("correct");
              correctCount++;
            } else {
              feedbackMark.textContent = "✗";
              feedbackMark.classList.add("incorrect");
              select.classList.add("incorrect");
              incorrectCount++;
            }
            feedbackMark.style.visibility = "visible";
          } else {
            // If the input is empty, leave feedback hidden
          }
        });

        updateScores();
        checkBtn.disabled = true;

        if (correctCount + incorrectCount === sentencesData.length) {
          triggerReward(correctCount);
        }
      }

      function updateScores() {
        correctScoreEl.textContent = correctCount;
        incorrectScoreEl.textContent = incorrectCount;
      }

      // --- Reward System ---
      function triggerReward(score) {
        if (score >= 1 && score <= 10) {
          launchStars(1);
        } else if (score >= 11 && score <= 20) {
          launchStars(2);
        } else if (score >= 21 && score <= 30) {
          launchStars(3);
        } else if (score >= 31 && score <= 39) {
          launchStars(4);
        } else if (score === 40) {
          starRain();
        }
      }

      // --- Canvas Animation (unchanged) ---
      let stars = [];
      let animationFrameId;

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      class Star {
        constructor(x, y, radius, color, velocity) {
          this.x = x;
          this.y = y;
          this.radius = radius;
          this.color = color;
          this.velocity = velocity;
          this.alpha = 1;
          this.gravity = 0.05;
          this.friction = 0.99;
        }
        draw() {
          ctx.save();
          ctx.globalAlpha = this.alpha;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fillStyle = this.color;
          ctx.fill();
          ctx.restore();
        }
        update() {
          this.velocity.y += this.gravity;
          this.velocity.x *= this.friction;
          this.x += this.velocity.x;
          this.y += this.velocity.y;
          this.alpha -= 0.01;
          this.draw();
        }
      }

      function animateStars() {
        animationFrameId = requestAnimationFrame(animateStars);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        stars.forEach((star, index) => {
          if (star.alpha > 0) star.update();
          else stars.splice(index, 1);
        });
        if (stars.length === 0) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
      }

      function launchStars(count) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const colors = ["#fde047", "#f97316", "#84cc16", "#38bdf8"];
        for (let i = 0; i < count; i++) {
          const radius = 25 + Math.random() * 15;
          const x = centerX - 200 + i * 200;
          const y = centerY;
          const color = colors[i % colors.length];
          const velocity = {
            x: (Math.random() - 0.5) * 4,
            y: -12 - Math.random() * 5,
          };
          stars.push(new Star(x, y, radius, color, velocity));
        }
        if (!animationFrameId) animateStars();
      }

      function starRain() {
        for (let i = 0; i < 150; i++) {
          const radius = Math.random() * 3 + 1;
          const x = Math.random() * canvas.width;
          const y = -Math.random() * canvas.height;
          const color = `hsl(${Math.random() * 360}, 100%, 75%)`;
          const velocity = {
            x: (Math.random() - 0.5) * 2,
            y: 4 + Math.random() * 5,
          };
          stars.push(new Star(x, y, radius, color, velocity));
        }
        if (!animationFrameId) animateStars();
      }

      // --- Event Listeners ---
      closeBtn.addEventListener("click", () => window.close());
      checkBtn.addEventListener("click", checkAnswers);
      resetBtn.addEventListener("click", initializeGame);
      window.addEventListener("resize", resizeCanvas);

      // --- Initial Load ---
      window.onload = () => {
        resizeCanvas();
        initializeGame();
      };
    </script>
  </body>
</html>
