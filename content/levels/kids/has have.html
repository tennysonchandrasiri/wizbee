<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Has or Have? The Verb Game!</title>
    <link rel="preload" href="../../fonts/Inter-Variable.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="../../fonts/BubblegumSans-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="stylesheet" href="../../src/output.css">
    <link rel="stylesheet" href="../../twootle-theme.css">
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .title-font {
        font-family: "Bubblegum Sans", cursive;
      }
      /* Custom animation for feedback */
      @keyframes pop-in {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }
        80% {
          transform: scale(1.1);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      .pop-in {
        animation: pop-in 0.4s ease-out forwards;
      }
      /* Button press effect */
      .btn-press:active {
        transform: scale(0.95);
        transition: transform 0.1s ease-in-out;
      }
    </style>
  </head>
  <body class="bg-rose-100 flex items-center justify-center min-h-screen p-4">
    <div
      id="game-container"
      class="w-full max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-6 sm:p-8 text-center transition-all duration-300"
    >
      <header class="mb-6 flex justify-between items-start">
        <div>
          <h1 class="title-font text-4xl sm:text-5xl text-rose-600 text-left">
            Has or Have?
          </h1>
          <p class="text-gray-500 mt-2 text-lg text-left">
            Choose the correct word to complete the sentence!
          </p>
        </div>
        <button
          id="close-btn"
          class="p-2 text-gray-400 hover:text-rose-600 transition-colors"
          title="Close Game"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </header>

      <div
        id="score-board"
        class="bg-rose-50 rounded-lg p-2 mb-6 text-2xl font-bold text-rose-700"
      >
        Score: <span id="score">0</span>
      </div>

      <div
        id="sentence-container"
        class="bg-gray-100 rounded-lg p-6 my-6 h-32 flex items-center justify-center"
      >
        <p
          id="sentence"
          class="text-2xl sm:text-3xl font-semibold text-gray-800 tracking-wide"
        ></p>
      </div>

      <div id="choices-container" class="flex justify-center gap-4 mb-6">
        <button
          data-choice="has"
          class="choice-btn btn-press text-2xl font-bold p-4 rounded-xl shadow-md transition-all duration-200 bg-emerald-400 hover:bg-emerald-500 text-white w-40"
        >
          has
        </button>
        <button
          data-choice="have"
          class="choice-btn btn-press text-2xl font-bold p-4 rounded-xl shadow-md transition-all duration-200 bg-rose-400 hover:bg-rose-500 text-white w-40"
        >
          have
        </button>
      </div>

      <div
        id="feedback-container"
        class="h-10 mb-4 flex items-center justify-center"
      >
        <p id="feedback-message" class="text-2xl font-bold"></p>
      </div>

      <div id="controls-container" class="h-14">
        <button
          id="next-btn"
          class="hidden btn-press w-full sm:w-auto px-10 py-3 bg-rose-600 hover:bg-rose-700 text-white font-bold text-xl rounded-xl shadow-md transition-all duration-200"
        >
          Next Question
        </button>
      </div>

      <div id="final-screen" class="hidden text-center">
        <h2 class="title-font text-4xl text-emerald-500 mb-4">Awesome!</h2>
        <p class="text-2xl text-gray-700 mb-6">
          You finished the game! Your final score is:
        </p>
        <div
          class="bg-yellow-200 text-yellow-800 text-5xl font-bold rounded-full w-32 h-32 flex items-center justify-center mx-auto mb-8 shadow-inner"
        >
          <span id="final-score">0</span>
        </div>
        <button
          id="play-again-btn"
          class="btn-press w-full sm:w-auto px-10 py-4 bg-emerald-500 hover:bg-emerald-600 text-white font-bold text-xl rounded-xl shadow-md transition-all duration-200"
        >
          Play Again!
        </button>
      </div>
    </div>

    <audio id="success-sound" src="../../media/audio/brass.mp3" preload="auto"></audio>

    <script>
      const questions = [
        { part1: "He", part2: " a red ball.", answer: "has" },
        { part1: "They", part2: " many toys.", answer: "have" },
        { part1: "She", part2: " long hair.", answer: "has" },
        { part1: "I", part2: " a new puppy.", answer: "have" },
        { part1: "The cat", part2: " a fluffy tail.", answer: "has" },
        { part1: "You", part2: " a big smile.", answer: "have" },
        { part1: "We", part2: " a fun game to play.", answer: "have" },
        { part1: "The car", part2: " four wheels.", answer: "has" },
        { part1: "My friend", part2: " a blue bicycle.", answer: "has" },
        {
          part1: "The children",
          part2: " finished their homework.",
          answer: "have",
        },
        { part1: "It", part2: " a shiny cover.", answer: "has" },
        { part1: "I", part2: " an idea!", answer: "have" },
      ];

      const correctSound = new Audio("./media/aha.mp3");
      const wrongSoundHas = new Audio("./media/oh.mp3");
      const wrongSoundHave = new Audio("./media/oh.mp3");

      // --- DOM Elements (Added closeBtn and successSound) ---
      const gameContainer = document.getElementById("game-container");
      const scoreDisplay = document.getElementById("score");
      const sentenceEl = document.getElementById("sentence");
      const choicesContainer = document.getElementById("choices-container");
      const choiceBtns = document.querySelectorAll(".choice-btn");
      const feedbackContainer = document.getElementById("feedback-container");
      const feedbackMessage = document.getElementById("feedback-message");
      const nextBtn = document.getElementById("next-btn");
      const finalScreen = document.getElementById("final-screen");
      const finalScoreDisplay = document.getElementById("final-score");
      const playAgainBtn = document.getElementById("play-again-btn");
      const closeBtn = document.getElementById("close-btn"); // New
      const successSound = document.getElementById("success-sound"); // New

      // Game State
      let currentQuestionIndex = 0;
      let score = 0;
      let shuffledQuestions = [];

      // --- NEW: Animation function for the reward ---
      function triggerReward() {
        const emojiEl = document.createElement("div");
        emojiEl.textContent = "ðŸ†"; // Trophy emoji for winning
        emojiEl.style.position = "fixed";
        emojiEl.style.top = "50%";
        emojiEl.style.left = "50%";
        emojiEl.style.zIndex = "100";
        emojiEl.style.fontSize = "150px";
        emojiEl.style.opacity = "0";
        emojiEl.style.transform = "translate(-50%, -50%) scale(0)";
        emojiEl.style.transition =
          "transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s";

        document.body.appendChild(emojiEl);

        setTimeout(() => {
          emojiEl.style.opacity = "1";
          emojiEl.style.transform = "translate(-50%, -70%) scale(1)";
        }, 100);

        setTimeout(() => {
          emojiEl.style.opacity = "0";
          emojiEl.style.transform = "translate(-50%, -50%) scale(0.5)";
        }, 2200);

        setTimeout(() => {
          emojiEl.remove();
        }, 2800);
      }

      // --- NEW: Function to close the window ---
      function closeWindow() {
        window.location.href = '../../index.html';
      }

      function startGame() {
        currentQuestionIndex = 0;
        score = 0;
        shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
        scoreDisplay.textContent = score;
        finalScreen.classList.add("hidden");
        document.getElementById("score-board").classList.remove("hidden");
        document
          .getElementById("sentence-container")
          .classList.remove("hidden");
        choicesContainer.classList.remove("hidden");
        feedbackContainer.classList.remove("hidden");
        document
          .getElementById("controls-container")
          .classList.remove("hidden");
        displayQuestion();
      }

      function displayQuestion() {
        feedbackMessage.textContent = "";
        feedbackMessage.classList.remove(
          "pop-in",
          "text-green-500",
          "text-red-500"
        );
        nextBtn.classList.add("hidden");
        choiceBtns.forEach((btn) => {
          btn.disabled = false;
          btn.classList.remove("opacity-50", "cursor-not-allowed");
        });
        if (currentQuestionIndex >= shuffledQuestions.length) {
          endGame();
          return;
        }
        const question = shuffledQuestions[currentQuestionIndex];
        sentenceEl.innerHTML = `${question.part1} <span class="text-rose-600 font-bold">___</span> ${question.part2}`;
      }

      function handleChoice(e) {
        const selectedChoice = e.target.dataset.choice;
        if (!selectedChoice) return;
        const correctAnswer = shuffledQuestions[currentQuestionIndex].answer;
        choiceBtns.forEach((btn) => {
          btn.disabled = true;
          btn.classList.add("opacity-50", "cursor-not-allowed");
        });
        if (selectedChoice === correctAnswer) {
          score++;
          scoreDisplay.textContent = score;
          feedbackMessage.textContent = "Correct! ðŸŽ‰";
          feedbackMessage.className =
            "text-2xl font-bold pop-in text-green-500";
          correctSound.play();
        } else {
          feedbackMessage.textContent = "Try again! ðŸ¤”";
          feedbackMessage.className = "text-2xl font-bold pop-in text-red-500";
          switch (selectedChoice) {
            case "has":
              wrongSoundHas.play();
              break;
            case "have":
              wrongSoundHave.play();
              break;
          }
        }
        nextBtn.classList.remove("hidden");
      }

      function handleNextQuestion() {
        currentQuestionIndex++;
        displayQuestion();
      }

      // --- MODIFIED: Added success sound and animation trigger ---
      function endGame() {
        document.getElementById("score-board").classList.add("hidden");
        document.getElementById("sentence-container").classList.add("hidden");
        choicesContainer.classList.add("hidden");
        feedbackContainer.classList.add("hidden");
        document.getElementById("controls-container").classList.add("hidden");
        finalScoreDisplay.textContent = score;
        finalScreen.classList.remove("hidden");

        // Play success sound and show animation!
        if (successSound) {
          successSound.play();
        }
        triggerReward();
      }

      // --- Event Listeners (Added listener for close button) ---
      choiceBtns.forEach((btn) => btn.addEventListener("click", handleChoice));
      nextBtn.addEventListener("click", handleNextQuestion);
      playAgainBtn.addEventListener("click", startGame);
      closeBtn.addEventListener("click", closeWindow); // New

      // Initial game start
      startGame();
    </script>
  </body>
</html>
