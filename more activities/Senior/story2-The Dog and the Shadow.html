<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Dog and the Shadow - Quiz</title>
    <link rel="preload" href="../../fonts/Inter-Variable.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="../../fonts/BubblegumSans-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="stylesheet" href="../../dist/output.css" />
    <link rel="stylesheet" href="../../twootle-theme.css" />
    <link
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f9ff;
        color: #1e293b;
        overflow-x: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 1rem;
      }
      .card {
        background-color: #ffffff;
        border-radius: 1.5rem;
        padding: 2.5rem; /* Increased padding */
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        text-align: center;
        width: 100%;
        max-width: 900px;
        border: 1px solid #e2e8f0;
        position: relative; /* Needed for absolute positioning */
      }
      h1 {
        font-family: "Pacifico", cursive;
        text-align: center;
      }
      .story-section {
        text-align: left;
        background-color: #fffbeb; /* Light tan/yellow background */
        padding: 2rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
        line-height: 1.8;
        border: 1px solid #fde68a;
      }
      .quiz-section {
        text-align: left;
        background-color: #f1f5f9;
        padding: 2rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
        line-height: 1.8;
      }
      .story-section h2,
      .quiz-section h2 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }
      .story-text {
        font-style: italic;
        color: #475569;
      }
      .story-text p {
        margin-bottom: 0.5rem;
      }
      .story-moral {
        font-weight: 600;
        margin-top: 1.5rem;
      }
      .question-group {
        margin-bottom: 1.5rem;
      }
      .question-group p {
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      .answer-options button,
      .fill-in-blank input {
        padding: 0.5rem 1.5rem;
        border-radius: 0.5rem;
        border: 1px solid #cbd5e1;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .answer-options button:hover:not(:disabled) {
        background-color: #e2e8f0;
      }
      .answer-options button.selected {
        background-color: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }
      .answer-options button.correct {
        background-color: #4ade80;
        color: white;
        border-color: #22c55e;
      }
      .answer-options button.incorrect {
        background-color: #f87171;
        color: white;
        border-color: #ef4444;
      }
      .fill-in-blank input {
        width: 200px;
        height: 40px;
        text-align: center;
        font-size: 1rem;
      }
      .fill-in-blank input.correct {
        border-color: #22c55e;
        background-color: #f0fdf4;
      }
      .fill-in-blank input.incorrect {
        border-color: #ef4444;
        background-color: #fef2f2;
      }
      .btn {
        padding: 0.75rem 2rem;
        border-radius: 0.75rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: #3b82f6;
        color: white;
      }
      .btn-primary:hover:not(:disabled) {
        background-color: #2563eb;
        transform: translateY(-2px);
      }
      .btn-secondary {
        background-color: #e2e8f0;
        color: #334155;
      }
      .btn-secondary:hover:not(:disabled) {
        background-color: #cbd5e1;
        transform: translateY(-2px);
      }
      #feedback {
        margin-top: 1.5rem;
        font-weight: 600;
        min-height: 24px;
        font-size: 1.1rem;
      }
      .correct-feedback {
        color: #22c55e;
      }
      .incorrect-feedback {
        color: #ef4444;
      }
      .hidden {
        display: none;
      }

      /* --- NEW STYLES --- */
      #close-btn {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        color: #94a3b8;
        cursor: pointer;
        transition: color 0.2s;
        background: none;
        border: none;
      }
      #close-btn:hover {
        color: #3b82f6;
      }
      #trophy-container {
        font-size: 5rem; /* Make emoji large */
        margin-top: 1.5rem;
        transform: scale(0); /* Start scaled down */
        transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); /* Bouncy animation */
      }
      #trophy-container.show {
        transform: scale(1); /* Scale up to full size */
      }
      /* --- END NEW STYLES --- */
    </style>
  </head>
  <body>
    <div class="card">
      <button id="close-btn" title="Close">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-7 w-7"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

      <h1 class="text-4xl font-bold text-slate-800 mb-6">
        <span style="color: #f59e0b">The</span>
        <span style="color: #ef4444">Dog</span>
        <span style="color: #3b82f6">and</span>
        <span style="color: #10b981">the</span>
        <span style="color: #6366f1">Shadow</span>
      </h1>

      <div class="story-section mb-6">
        <h2 class="text-xl">Story</h2>
        <div class="story-text">
          <p>
            One afternoon, a dog trotted happily along a path with a juicy bone
            in his mouth.
          </p>
          <p>
            <strong>Dog (muffled, with bone):</strong> ‚ÄúMmm‚Ä¶ this is the best
            bone I‚Äôve ever found!‚Äù
          </p>
          <p>He reached a narrow bridge over a stream.</p>
          <p><strong>Dog (pausing):</strong> ‚ÄúCareful now‚Ä¶ don‚Äôt drop it.‚Äù</p>
          <p>He glanced into the water and froze.</p>
          <p>
            <strong>Dog:</strong> ‚ÄúWhat‚Äôs this? Another dog‚Ä¶ with a bone even
            bigger than mine!‚Äù
          </p>
          <p>The ‚Äúother dog‚Äù was just his reflection.</p>
          <p>
            <strong>Dog (thinking):</strong> ‚ÄúIf I can scare him, I can take his
            bone too.‚Äù
          </p>
          <p>He growled at the water.</p>
          <p><strong>Dog:</strong> ‚ÄúGrr! Give me that bone!‚Äù</p>
          <p>The reflection growled back.</p>
          <p><strong>Dog:</strong> ‚ÄúOh, so you want to fight? Fine!‚Äù</p>
          <p>
            He opened his mouth to bark ‚Äî SPLASH! The bone fell into the water
            and sank.
          </p>
          <p><strong>Dog:</strong> ‚ÄúOh no! My bone! Where is it?!‚Äù</p>
          <p>The stream rippled, carrying it away.</p>
          <p>
            <strong>Dog (sighing):</strong> ‚ÄúI was too greedy‚Ä¶ now I have
            nothing.‚Äù
          </p>
        </div>
        <p class="story-moral">
          Moral: Beware of being greedy ‚Äî you may lose what you already have.
        </p>
      </div>

      <div class="quiz-section">
        <h2 class="text-xl">Quiz Time!</h2>
        <p class="mb-4 text-slate-500">
          Read the story and answer the questions below.
        </p>

        <form id="quiz-form">
          <div class="true-false-section question-group">
            <p class="text-base font-semibold mb-2">True or False</p>
            <div class="mb-4">
              <label for="q1" class="block mb-2"
                >1. The dog was carrying a bone in his mouth.</label
              >
              <div class="answer-options flex justify-center gap-4">
                <button type="button" data-question="q1" data-answer="true">
                  True
                </button>
                <button type="button" data-question="q1" data-answer="false">
                  False
                </button>
              </div>
            </div>
            <div class="mb-4">
              <label for="q2" class="block mb-2"
                >2. The dog saw another dog with a smaller bone in the
                water.</label
              >
              <div class="answer-options flex justify-center gap-4">
                <button type="button" data-question="q2" data-answer="true">
                  True
                </button>
                <button type="button" data-question="q2" data-answer="false">
                  False
                </button>
              </div>
            </div>
            <div class="mb-4">
              <label for="q3" class="block mb-2"
                >3. The dog lost his bone because he fell into the water.</label
              >
              <div class="answer-options flex justify-center gap-4">
                <button type="button" data-question="q3" data-answer="true">
                  True
                </button>
                <button type="button" data-question="q3" data-answer="false">
                  False
                </button>
              </div>
            </div>
            <div class="mb-4">
              <label for="q4" class="block mb-2"
                >4. The dog was happy with his bone after seeing the
                reflection.</label
              >
              <div class="answer-options flex justify-center gap-4">
                <button type="button" data-question="q4" data-answer="true">
                  True
                </button>
                <button type="button" data-question="q4" data-answer="false">
                  False
                </button>
              </div>
            </div>
            <div class="mb-4">
              <label for="q5" class="block mb-2"
                >5. The moral of the story is to not be greedy.</label
              >
              <div class="answer-options flex justify-center gap-4">
                <button type="button" data-question="q5" data-answer="true">
                  True
                </button>
                <button type="button" data-question="q5" data-answer="false">
                  False
                </button>
              </div>
            </div>
          </div>

          <hr class="my-6 border-slate-300" />

          <div class="fill-in-blanks-section question-group">
            <p class="text-base font-semibold mb-2">Fill in the Blanks</p>
            <div class="mb-4">
              <label for="q6" class="block mb-2"
                >6. The dog was carrying a juicy _________.</label
              >
              <div class="fill-in-blank flex justify-center">
                <input
                  type="text"
                  id="q6"
                  data-answer="bone"
                  class="p-2 border rounded"
                />
              </div>
            </div>
            <div class="mb-4">
              <label for="q7" class="block mb-2"
                >7. He reached a narrow _________ over a stream.</label
              >
              <div class="fill-in-blank flex justify-center">
                <input
                  type="text"
                  id="q7"
                  data-answer="bridge"
                  class="p-2 border rounded"
                />
              </div>
            </div>
            <div class="mb-4">
              <label for="q8" class="block mb-2"
                >8. The 'other dog' was just his _________.</label
              >
              <div class="fill-in-blank flex justify-center">
                <input
                  type="text"
                  id="q8"
                  data-answer="reflection"
                  class="p-2 border rounded"
                />
              </div>
            </div>
            <div class="mb-4">
              <label for="q9" class="block mb-2"
                >9. The dog opened his mouth to bark and the bone fell with a
                _________.</label
              >
              <div class="fill-in-blank flex justify-center">
                <input
                  type="text"
                  id="q9"
                  data-answer="splash"
                  class="p-2 border rounded"
                />
              </div>
            </div>
            <div class="mb-4">
              <label for="q10" class="block mb-2"
                >10. In the end, the dog was sad because he had
                _________.</label
              >
              <div class="fill-in-blank flex justify-center">
                <input
                  type="text"
                  id="q10"
                  data-answer="nothing"
                  class="p-2 border rounded"
                />
              </div>
            </div>
          </div>
        </form>

        <div id="feedback" class="text-center mt-6"></div>

        <div id="trophy-container" class="hidden">üèÜ</div>

        <div class="mt-8 flex justify-center space-x-4">
          <button id="reset-btn" class="btn btn-secondary">Reset</button>
          <button id="check-btn" class="btn btn-primary">Check Answers</button>
        </div>
      </div>
    </div>

    <audio id="success-sound" src="media/success.mp3" preload="auto"></audio>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("quiz-form");
        const checkBtn = document.getElementById("check-btn");
        const resetBtn = document.getElementById("reset-btn");
        const feedbackDiv = document.getElementById("feedback");

        // --- NEW: Select new elements ---
        const closeBtn = document.getElementById("close-btn");
        const successSound = document.getElementById("success-sound");
        const trophyContainer = document.getElementById("trophy-container");
        // --- END NEW ---

        // Store the correct answers
        const correctAnswers = {
          q1: "true",
          q2: "false",
          q3: "false",
          q4: "false",
          q5: "true",
          q6: "bone",
          q7: "bridge",
          q8: "reflection",
          q9: "splash",
          q10: "nothing",
        };

        // Event listeners for True/False buttons
        document
          .querySelectorAll(".answer-options button")
          .forEach((button) => {
            button.addEventListener("click", (e) => {
              const questionId = e.target.dataset.question;
              document
                .querySelectorAll(`button[data-question="${questionId}"]`)
                .forEach((btn) => {
                  btn.classList.remove("selected");
                });
              e.target.classList.add("selected");
            });
          });

        // Check Answers button logic
        checkBtn.addEventListener("click", () => {
          let score = 0;
          const totalQuestions = Object.keys(correctAnswers).length;

          // Check True/False answers
          document
            .querySelectorAll(".answer-options button.selected")
            .forEach((button) => {
              const questionId = button.dataset.question;
              const userAnswer = button.dataset.answer;
              if (userAnswer === correctAnswers[questionId]) {
                button.classList.add("correct");
                score++;
              } else {
                button.classList.add("incorrect");
              }
            });

          // Check Fill-in-the-Blanks answers
          document.querySelectorAll(".fill-in-blank input").forEach((input) => {
            const questionId = input.id;
            const userAnswer = input.value.toLowerCase().trim();
            const correctAnswer = correctAnswers[questionId];
            if (userAnswer === correctAnswer) {
              input.classList.add("correct");
              score++;
            } else {
              input.classList.add("incorrect");
              input.value = correctAnswer; // Show correct answer
            }
          });

          // --- UPDATED: Display feedback ---
          if (score === totalQuestions) {
            feedbackDiv.textContent = "Perfect score! You know the story well!";
            feedbackDiv.className = "correct-feedback";
            // Play sound and show trophy on success
            successSound.play();
            trophyContainer.classList.remove("hidden");
            setTimeout(() => {
              trophyContainer.classList.add("show");
            }, 10); // Timeout ensures animation runs
          } else {
            feedbackDiv.textContent = `You got ${score} out of ${totalQuestions} questions correct. Try again!`;
            feedbackDiv.className = "incorrect-feedback";
          }
          // --- END UPDATE ---

          // Disable buttons and inputs after checking
          checkBtn.disabled = true;
          document
            .querySelectorAll(".answer-options button, .fill-in-blank input")
            .forEach((el) => (el.disabled = true));
        });

        // Reset button logic
        resetBtn.addEventListener("click", () => {
          document
            .querySelectorAll(".answer-options button")
            .forEach((button) => {
              button.classList.remove("selected", "correct", "incorrect");
              button.disabled = false;
            });
          document.querySelectorAll(".fill-in-blank input").forEach((input) => {
            input.value = "";
            input.classList.remove("correct", "incorrect");
            input.disabled = false;
          });
          feedbackDiv.textContent = "";
          feedbackDiv.className = "";
          checkBtn.disabled = false;

          // --- NEW: Hide trophy on reset ---
          trophyContainer.classList.remove("show");
          trophyContainer.classList.add("hidden");
          // --- END NEW ---
        });

        // --- NEW: Close button logic ---
        closeBtn.addEventListener("click", () => {
          window.close();
        });
        // --- END NEW ---
      });
    </script>
  </body>
</html>
