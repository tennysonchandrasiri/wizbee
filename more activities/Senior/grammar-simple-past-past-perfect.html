<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Past Tense Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f0f9ff;
        color: #1e293b;
        overflow-x: hidden;
      }
      .game-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 1rem;
      }
      .card {
        background-color: #ffffff;
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        text-align: center;
        width: 100%;
        max-width: 900px;
        border: 1px solid #e0f2fe;
        position: relative;
      }
      .close-btn {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        background-color: #f1f5f9;
        color: #64748b;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
      }
      .close-btn:hover {
        background-color: #e2e8f0;
        transform: scale(1.1);
      }
      #top-bar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        margin-bottom: 1.5rem;
        width: 100%;
      }
      #score-container {
        display: flex;
        gap: 1rem;
      }
      .score-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      #correct-score {
        background-color: #22c55e;
      }
      #incorrect-score {
        background-color: #ef4444;
      }

      #sentences-container {
        list-style-type: decimal;
        list-style-position: inside;
        text-align: left;
        font-size: 1.2rem;
        line-height: 3;
      }
      .sentence-item {
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        margin-bottom: 0.1rem;
      }
      .blank-select {
        display: inline-block;
        width: 250px;
        height: 40px;
        background-color: #e2e8f0;
        border: 2px solid #cbd5e1;
        border-radius: 0.5rem;
        margin: 0 4px -10px 4px;
        transition: all 0.3s ease;
        vertical-align: middle;
        font-size: 1.1rem;
        font-weight: 600;
        padding-left: 10px;
      }
      .blank-select:focus {
        outline: none;
        border-color: #3b82f6;
        background-color: #e0f2fe;
      }
      .blank-select.correct {
        background-color: #4ade80;
        border-color: #22c55e;
        color: white;
      }
      .blank-select.incorrect {
        background-color: #f87171;
        border-color: #ef4444;
        color: white;
      }
      .feedback-mark {
        display: inline-block;
        margin-left: 0.75rem;
        font-size: 1.5rem;
        font-weight: bold;
        visibility: hidden;
      }
      .feedback-mark.correct {
        color: #22c55e;
        visibility: visible;
      }
      .feedback-mark.incorrect {
        color: #ef4444;
        visibility: visible;
      }
      .btn {
        padding: 0.75rem 2rem;
        border-radius: 0.75rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
        border: none;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: #3b82f6;
        color: white;
      }
      .btn-primary:hover {
        background-color: #2563eb;
        transform: translateY(-2px);
      }
      .btn-secondary {
        background-color: #e2e8f0;
        color: #334155;
      }
      .btn-secondary:hover {
        background-color: #cbd5e1;
        transform: translateY(-2px);
      }
      #reward-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 100;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="card">
        <button id="close-btn" class="close-btn" aria-label="Close">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <h1
          class="text-4xl font-bold text-slate-800 mb-2"
          style="font-family: 'Pacifico', cursive"
        >
          Simple Past vs. Present Perfect
        </h1>
        <p class="mb-6 text-lg text-slate-500">
          Fill in the blanks with the correct verb form: **Simple Past** or
          **Present Perfect**.
        </p>

        <div id="top-bar">
          <div id="score-container">
            <div id="correct-score" class="score-circle">0</div>
            <div id="incorrect-score" class="score-circle">0</div>
          </div>
        </div>

        <ol id="sentences-container"></ol>

        <div class="mt-8 flex justify-center space-x-4">
          <button id="reset-btn" class="btn btn-secondary">Try Again</button>
          <button id="check-btn" class="btn btn-primary">Check Answers</button>
        </div>
      </div>
    </div>

    <canvas id="reward-canvas"></canvas>

    <script>
      const sentencesData = [
        {
          sentence: "I ______ my grandparents last Sunday.",
          correctAnswer: "visited",
          options: ["have visited", "visited"],
        },
        {
          sentence: "She ______ that actor before.",
          correctAnswer: "has met",
          options: ["met", "has met"],
        },
        {
          sentence: "They ______ three new houses in this street.",
          correctAnswer: "have built",
          options: ["built", "have built"],
        },
        {
          sentence: "We ______ a lot of fun this week.",
          correctAnswer: "have had",
          options: ["had", "have had"],
        },
        {
          sentence: "He ______ me with my homework yesterday evening.",
          correctAnswer: "helped",
          options: ["has helped", "helped"],
        },
        {
          sentence: "I ______ that game before.",
          correctAnswer: "have played",
          options: ["played", "have played"],
        },
        {
          sentence: "Our teacher ______ the lesson in the previous class.",
          correctAnswer: "explained",
          options: ["has explained", "explained"],
        },
        {
          sentence: "We ______ to the new shopping mall twice.",
          correctAnswer: "have gone",
          options: ["went", "have gone"],
        },
        {
          sentence: "My parents ______ to Kandy in April.",
          correctAnswer: "traveled",
          options: ["have traveled", "traveled"],
        },
        {
          sentence: "She ______ a new book.",
          correctAnswer: "has started",
          options: ["started", "has started"],
        },
        {
          sentence: "I ______ you an hour ago.",
          correctAnswer: "called",
          options: ["have called", "called"],
        },
        {
          sentence: "We ______ the museum before.",
          correctAnswer: "have visited",
          options: ["visited", "have visited"],
        },
        {
          sentence: "The bus ______ at 7:30 a.m. yesterday.",
          correctAnswer: "arrived",
          options: ["has arrived", "arrived"],
        },
        {
          sentence: "He ______ many competitions.",
          correctAnswer: "has joined",
          options: ["joined", "has joined"],
        },
        {
          sentence: "I ______ an email to my cousin last night.",
          correctAnswer: "wrote",
          options: ["have written", "wrote"],
        },
        {
          sentence: "They ______ that movie twice.",
          correctAnswer: "have watched",
          options: ["watched", "have watched"],
        },
        {
          sentence: "Our school ______ a science fair last month.",
          correctAnswer: "hosted",
          options: ["has hosted", "hosted"],
        },
        {
          sentence: "She ______ cookies this morning.",
          correctAnswer: "has baked",
          options: ["baked", "has baked"],
        },
        {
          sentence: "I ______ you my book last week.",
          correctAnswer: "lent",
          options: ["have lent", "lent"],
        },
        {
          sentence: "We ______ many meals together this year.",
          correctAnswer: "have had",
          options: ["had", "have had"],
        },
        {
          sentence: "She ______ her friend at the park yesterday.",
          correctAnswer: "met",
          options: ["has met", "met"],
        },
        {
          sentence: "They ______ a new library in our town in 2020.",
          correctAnswer: "built",
          options: ["have built", "built"],
        },
        {
          sentence: "We ______ a party at school last Friday.",
          correctAnswer: "had",
          options: ["have had", "had"],
        },
        {
          sentence: "He ______ me whenever I needed it.",
          correctAnswer: "has helped",
          options: ["helped", "has helped"],
        },
        {
          sentence: "I ______ in the football match last night.",
          correctAnswer: "played",
          options: ["have played", "played"],
        },
        {
          sentence: "Our teacher ______ this topic already.",
          correctAnswer: "has explained",
          options: ["explained", "has explained"],
        },
        {
          sentence: "We ______ shopping in the city last weekend.",
          correctAnswer: "went",
          options: ["have gone", "went"],
        },
        {
          sentence: "My parents ______ to Nuwara Eliya several times.",
          correctAnswer: "have traveled",
          options: ["traveled", "have traveled"],
        },
        {
          sentence: "She ______ her new dance class last Monday.",
          correctAnswer: "started",
          options: ["has started", "started"],
        },
        {
          sentence: "I ______ you three times today.",
          correctAnswer: "have called",
          options: ["called", "have called"],
        },
        {
          sentence: "We ______ the museum with our class last week.",
          correctAnswer: "visited",
          options: ["have visited", "visited"],
        },
        {
          sentence: "The bus ______ already.",
          correctAnswer: "has arrived",
          options: ["arrived", "has arrived"],
        },
        {
          sentence: "He ______ the chess club last term.",
          correctAnswer: "joined",
          options: ["has joined", "joined"],
        },
        {
          sentence: "I ______ three stories this month.",
          correctAnswer: "have written",
          options: ["wrote", "have written"],
        },
        {
          sentence: "They ______ a movie together last Saturday.",
          correctAnswer: "watched",
          options: ["have watched", "watched"],
        },
        {
          sentence: "Our school ______ many events.",
          correctAnswer: "has hosted",
          options: ["hosted", "has hosted"],
        },
        {
          sentence: "She ______ a cake for her sister’s birthday yesterday.",
          correctAnswer: "baked",
          options: ["has baked", "baked"],
        },
        {
          sentence: "I ______ books to many friends.",
          correctAnswer: "have lent",
          options: ["lent", "have lent"],
        },
        {
          sentence: "We ______ lunch with our relatives on Sunday.",
          correctAnswer: "had",
          options: ["have had", "had"],
        },
        {
          sentence: "I ______ my grandparents many times.",
          correctAnswer: "have visited",
          options: ["visited", "have visited"],
        },
      ];

      // --- DOM Elements ---
      const sentencesContainer = document.getElementById("sentences-container");
      const closeBtn = document.getElementById("close-btn");
      const checkBtn = document.getElementById("check-btn");
      const resetBtn = document.getElementById("reset-btn");
      const correctScoreEl = document.getElementById("correct-score");
      const incorrectScoreEl = document.getElementById("incorrect-score");
      const canvas = document.getElementById("reward-canvas");
      const ctx = canvas.getContext("2d");

      // --- Game State ---
      let correctCount = 0;
      let incorrectCount = 0;

      // --- Initialization ---
      function initializeGame() {
        sentencesContainer.innerHTML = "";
        correctCount = 0;
        incorrectCount = 0;
        updateScores();
        checkBtn.disabled = false;

        // Shuffle the sentences data
        const shuffledSentences = sentencesData.sort(() => 0.5 - Math.random());

        shuffledSentences.forEach((item) => {
          const li = document.createElement("li");
          li.className = "sentence-item flex items-center";

          const blankIndex = item.sentence.indexOf("______");
          const sentencePart1 = item.sentence.substring(0, blankIndex);
          const sentencePart2 = item.sentence.substring(blankIndex + 6);

          // Add the first part of the sentence
          li.innerHTML += `${sentencePart1}`;

          // Create and append the select dropdown
          const select = document.createElement("select");
          select.className = "blank-select";
          select.dataset.correctVerb = item.correctAnswer;

          // Default blank option
          const defaultOption = document.createElement("option");
          defaultOption.value = "";
          defaultOption.textContent = "--- Choose an option ---";
          select.appendChild(defaultOption);

          // Add the actual verb options
          const shuffledOptions = item.options.sort(() => 0.5 - Math.random());
          shuffledOptions.forEach((optionText) => {
            const option = document.createElement("option");
            option.textContent = optionText;
            option.value = optionText;
            select.appendChild(option);
          });

          li.appendChild(select);
          li.innerHTML += `${sentencePart2} <span class="feedback-mark"></span>`;

          sentencesContainer.appendChild(li);
        });
      }

      // --- Answer Checking ---
      function checkAnswers() {
        const selects = document.querySelectorAll(".blank-select");
        correctCount = 0;
        incorrectCount = 0;

        selects.forEach((select) => {
          const userAnswer = select.value.trim();
          const correctVerb = select.dataset.correctVerb;
          const feedbackMark =
            select.parentElement.querySelector(".feedback-mark");

          select.classList.remove("correct", "incorrect");
          feedbackMark.classList.remove("correct", "incorrect");
          feedbackMark.style.visibility = "hidden";

          if (userAnswer) {
            if (userAnswer === correctVerb) {
              feedbackMark.textContent = "✓";
              feedbackMark.classList.add("correct");
              select.classList.add("correct");
              correctCount++;
            } else {
              feedbackMark.textContent = "✗";
              feedbackMark.classList.add("incorrect");
              select.classList.add("incorrect");
              incorrectCount++;
            }
            feedbackMark.style.visibility = "visible";
          } else {
            // If the input is empty, leave feedback hidden
          }
        });

        updateScores();
        checkBtn.disabled = true;

        if (correctCount + incorrectCount === sentencesData.length) {
          triggerReward(correctCount);
        }
      }

      function updateScores() {
        correctScoreEl.textContent = correctCount;
        incorrectScoreEl.textContent = incorrectCount;
      }

      // --- Reward System (unchanged) ---
      function triggerReward(score) {
        if (score >= 1 && score <= 10) {
          launchStars(1);
        } else if (score >= 11 && score <= 25) {
          launchStars(2);
        } else if (score >= 26 && score <= 39) {
          launchStars(3);
        } else if (score === 40) {
          starRain();
        }
      }

      // --- Canvas Animation (unchanged) ---
      let stars = [];
      let animationFrameId;

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      class Star {
        constructor(x, y, radius, color, velocity) {
          this.x = x;
          this.y = y;
          this.radius = radius;
          this.color = color;
          this.velocity = velocity;
          this.alpha = 1;
          this.gravity = 0.05;
          this.friction = 0.99;
        }
        draw() {
          ctx.save();
          ctx.globalAlpha = this.alpha;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fillStyle = this.color;
          ctx.fill();
          ctx.restore();
        }
        update() {
          this.velocity.y += this.gravity;
          this.velocity.x *= this.friction;
          this.x += this.velocity.x;
          this.y += this.velocity.y;
          this.alpha -= 0.01;
          this.draw();
        }
      }

      function animateStars() {
        animationFrameId = requestAnimationFrame(animateStars);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        stars.forEach((star, index) => {
          if (star.alpha > 0) star.update();
          else stars.splice(index, 1);
        });
        if (stars.length === 0) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
      }

      function launchStars(count) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const colors = ["#fde047", "#f97316", "#84cc16", "#38bdf8"];
        for (let i = 0; i < count; i++) {
          const radius = 25 + Math.random() * 15;
          const x = centerX - 200 + i * 200;
          const y = centerY;
          const color = colors[i % colors.length];
          const velocity = {
            x: (Math.random() - 0.5) * 4,
            y: -12 - Math.random() * 5,
          };
          stars.push(new Star(x, y, radius, color, velocity));
        }
        if (!animationFrameId) animateStars();
      }

      function starRain() {
        for (let i = 0; i < 150; i++) {
          const radius = Math.random() * 3 + 1;
          const x = Math.random() * canvas.width;
          const y = -Math.random() * canvas.height;
          const color = `hsl(${Math.random() * 360}, 100%, 75%)`;
          const velocity = {
            x: (Math.random() - 0.5) * 2,
            y: 4 + Math.random() * 5,
          };
          stars.push(new Star(x, y, radius, color, velocity));
        }
        if (!animationFrameId) animateStars();
      }

      // --- Event Listeners ---
      closeBtn.addEventListener("click", () => window.close());
      checkBtn.addEventListener("click", checkAnswers);
      resetBtn.addEventListener("click", initializeGame);
      window.addEventListener("resize", resizeCanvas);

      // --- Initial Load ---
      window.onload = () => {
        resizeCanvas();
        initializeGame();
      };
    </script>
  </body>
</html>
